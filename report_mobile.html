
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>B√°o C√°o T√†i Ch√≠nh - Mobile</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        :root {
            /* Material Design Color System */
            --md-sys-color-primary: #1E88E5;
            --md-sys-color-primary-container: #E3F2FD;
            --md-sys-color-secondary: #455A64;
            --md-sys-color-secondary-container: #ECEFF1;
            --md-sys-color-surface: #FFFFFF;
            --md-sys-color-surface-variant: #F3F4F6;
            --md-sys-color-background: #F3F4F6;
            --md-sys-color-outline: #E0E0E0;
            --md-sys-color-error: #D32F2F;
            --md-sys-color-success: #2E7D32;
            --md-sys-color-warning: #F9A825;
            --md-sys-color-on-surface: #111827;
            --md-sys-color-on-surface-variant: #6B7280;
            
            /* Material-ish palette (override) */
            --color-primary: #1E88E5;
            --color-primary-soft: #E3F2FD;
            --color-success: #2E7D32;
            --color-warning: #F9A825;
            --color-danger: #D32F2F;
            --color-bg: #F3F4F6;
            --color-surface: #FFFFFF;
            --color-border: #E0E0E0;
            --color-text-main: #111827;
            --color-text-muted: #6B7280;
            --color-divider: #D1D5DB;
            
            /* Legacy variables for backward compatibility */
            --primary: var(--color-primary);
            --success: var(--color-success);
            --warning: var(--color-warning);
            --danger: var(--color-danger);
            --bg: var(--color-bg);
            --card-bg: var(--color-surface);
            --text: var(--color-text-main);
            --text-light: var(--color-text-muted);
            --border: var(--color-border);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        /* === MATERIAL HEADER & BODY === */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-size: 14px;
            font-weight: 400;
            line-height: 1.4;
            background: var(--color-bg);
            color: var(--color-text-main);
            padding-bottom: 80px;
            overflow-x: hidden;
        }
        
        /* Typography Scale */
        h1 { font-size: 18px; font-weight: 700; line-height: 1.25; }
        h2 { font-size: 15px; font-weight: 600; line-height: 1.25; }
        h3 { font-size: 13px; font-weight: 600; line-height: 1.25; }
        p, div, span { font-size: 14px; font-weight: 400; line-height: 1.25; }

        /* === MATERIAL OVERRIDE ‚Äì COLOR & SURFACE === */
        /* M√†u cho tr·∫°ng th√°i ranking */
        .bg-critical-light { 
            background: #FFEBEE;
            color: #D32F2F;
        }
        .text-critical {
            color: #D32F2F;
        }
        .bg-excellent-light {
            background: #E8F5E9;
            color: #2E7D32;
        }
        .text-excellent {
            color: #2E7D32;
        }
        .bg-average-light {
            background: #FFF8E1;
            color: #F9A825;
        }
        .text-average {
            color: #F9A825;
        }
        
        /* Utility Classes */
        .text-success { color: var(--success); }
        .text-warning { color: var(--warning); }
        .text-danger { color: var(--danger); }
        .bg-success-light { background: var(--color-primary-soft); color: var(--color-success); }
        .bg-warning-light { background: var(--color-primary-soft); color: var(--color-warning); }
        .bg-danger-light { background: var(--color-primary-soft); color: var(--color-danger); }
        
        /* === MATERIAL HEADER === */
        .header {
            background: var(--color-primary);
            color: #FFFFFF;
            padding: 16px 16px 14px;
            text-align: left;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(255, 255, 255, 0.12);
            box-shadow: none;
        }
        .header h1 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 2px;
        }
        .header p {
            font-size: 12px;
            opacity: 0.9;
        }

        /* Tab System */
        .tab-content { display: none; padding: 16px; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* === MATERIAL CARD & KPI === */
        .card {
            background: var(--color-surface);
            border-radius: 12px;
            padding: 14px 14px 12px;
            margin-bottom: 16px;
            border: 1px solid var(--color-border);
            box-shadow: none;
        }
        .card-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--color-text-main);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        /* KPI grid */
        .kpi-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 16px;
        }
        .kpi-card {
            background: var(--color-surface);
            border-radius: 12px;
            padding: 10px 10px 8px;
            box-shadow: none;
            border: 1px solid var(--color-border);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .kpi-label {
            font-size: 12px;
            color: var(--color-text-muted);
            margin-bottom: 4px;
        }
        .kpi-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--color-text-main);
            margin-bottom: 2px;
        }
        .kpi-sub {
            font-size: 12px;
            color: var(--color-text-muted);
        }
        /* KPI "stateful" d√πng n·ªÅn nh·∫π */
        .kpi-card.bg-success-light,
        .kpi-card.bg-warning-light,
        .kpi-card.bg-danger-light {
            border-radius: 12px;
            border-width: 1px;
            border-style: solid;
            box-shadow: none;
        }
        .kpi-card.bg-success-light {
            border-color: var(--color-success);
        }
        .kpi-card.bg-warning-light {
            border-color: var(--color-warning);
        }
        .kpi-card.bg-danger-light {
            border-color: var(--color-danger);
        }

        /* === MATERIAL RANKING === */
        .ranking-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--color-divider);
        }
        .ranking-item:last-child { border-bottom: none; }
        .ranking-icon {
            width: 32px;
            height: 32px;
            border-radius: 999px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            margin-right: 10px;
        }
        .ranking-icon.critical { background: #FFEBEE; color: var(--color-danger); }
        .ranking-icon.excellent { background: #E8F5E9; color: var(--color-success); }
        .ranking-icon.average { background: #FFF8E1; color: var(--color-warning); }
        .ranking-info {
            flex: 1;
        }
        .ranking-name {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 2px;
        }
        .ranking-detail {
            font-size: 12px;
            color: var(--color-text-muted);
        }
        .ranking-badge {
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 999px;
            border: 1px solid transparent;
        }
        /* K·∫øt h·ª£p v·ªõi c√°c bg-* m·ªõi */
        .bg-critical-light {
            border-color: #FFCDD2;
        }
        .bg-excellent-light {
            border-color: #C8E6C9;
        }
        .bg-average-light {
            border-color: #FFE082;
        }

        /* Accordion */
        .accordion { background: var(--color-surface); border-radius: 12px; overflow: hidden; margin-bottom: 16px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); border: 1px solid var(--color-border); }
        .accordion-header { padding: 16px; font-size: 13px; font-weight: 600; line-height: 1.25; display: flex; justify-content: space-between; align-items: center; cursor: pointer; background: var(--color-surface); color: var(--color-text-main); }
        .accordion-content { padding: 0 16px 16px; display: none; font-size: 14px; font-weight: 400; line-height: 1.25; color: var(--color-text-muted); border-top: 1px solid var(--color-divider); }
        .accordion-content.open { display: block; }
        .accordion-content ul { padding-left: 20px; margin-top: 8px; }
        .accordion-content li { margin-bottom: 6px; }

        /* === MATERIAL SEGMENTED CONTROL & TOGGLE === */
        .segmented-control {
            display: flex;
            background: #E5E7EB;
            padding: 4px;
            border-radius: 999px;
            margin-bottom: 16px;
        }
        .segment-btn {
            flex: 1;
            padding: 8px;
            border: none;
            background: transparent;
            border-radius: 999px;
            font-size: 13px;
            color: var(--color-text-muted);
            cursor: pointer;
            transition: background 0.15s, color 0.15s;
        }
        .segment-btn.active {
            background: var(--color-surface);
            color: var(--color-primary);
            box-shadow: none;
        }

        /* Toggle ki·ªÉu Material */
        .toggle-container { display: flex; justify-content: center; margin-bottom: 16px; }
        .toggle-wrapper {
            display: flex;
            background: #E5E7EB;
            border-radius: 999px;
            padding: 3px;
            position: relative;
        }
        .toggle-bg {
            position: absolute;
            top: 3px;
            bottom: 3px;
            left: 3px;
            width: 50%;
            background: var(--color-surface);
            border-radius: 999px;
            transition: transform 0.2s;
            box-shadow: 0 1px 2px rgba(15, 23, 42, 0.15);
        }
        .toggle-btn {
            padding: 6px 16px;
            border-radius: 999px;
            border: none;
            background: transparent;
            font-size: 13px;
            color: var(--color-text-muted);
            cursor: pointer;
        }
        .toggle-btn.active {
            color: var(--color-primary);
        }

        /* Chips */
        .chips-container { display: flex; gap: 8px; margin-bottom: 16px; overflow-x: auto; padding-bottom: 4px; }
        .chip { padding: 8px 16px; background: var(--color-surface); border: 1px solid var(--color-border); border-radius: 20px; font-size: 12px; font-weight: 400; line-height: 1.5; color: var(--color-text-muted); white-space: nowrap; cursor: pointer; transition: all 0.2s; }
        .chip.active { background: var(--color-primary); color: white; border-color: var(--color-primary); }

        /* Buttons */
        .btn { display: block; width: 100%; padding: 12px; border-radius: 8px; font-size: 14px; font-weight: 400; line-height: 1.5; text-align: center; border: none; cursor: pointer; margin-bottom: 12px; transition: opacity 0.2s; }
        .btn-primary { background: var(--color-primary); color: white; }
        .btn-outline { background: transparent; border: 1px solid var(--color-border); color: var(--color-primary); }
        .btn:active { opacity: 0.8; }

        /* Action List */
        .action-item { padding: 12px 0; border-bottom: 1px dashed var(--color-divider); display: flex; align-items: flex-start; }
        .action-item:last-child { border-bottom: none; }
        .action-check { margin-right: 10px; color: var(--color-success); font-weight: bold; }

        /* === MATERIAL BOTTOM NAV === */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--color-surface);
            border-top: 1px solid var(--color-border);
            display: flex;
            justify-content: space-around;
            padding: 6px 0;
            padding-bottom: max(6px, env(safe-area-inset-bottom));
            z-index: 1000;
            box-shadow: none;
        }
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 4px 0;
            cursor: pointer;
            color: var(--color-text-muted);
            font-size: 11px;
        }
        .nav-item.active {
            color: var(--color-primary);
        }
        .nav-icon {
            font-size: 20px;
            margin-bottom: 2px;
        }
        .nav-label {
            font-size: 11px;
            font-weight: 400;
        }

    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>B√°o c√°o kinh doanh S T I 2025</h1>
    </div>

    <!-- TAB 1: T·ªîNG QUAN -->
    <div id="tab-overview" class="tab-content active">
        <!-- KPI Grid -->
        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-label">T·ªïng Doanh Thu</div>
                <div class="kpi-value">66.383 M</div>
                <div class="kpi-sub">~6.638 M/th√°ng</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">T·ªïng LN</div>
                <div class="kpi-value">9.084 M</div>
                <div class="kpi-sub">Bi√™n LN/DT: 13.68%</div>
            </div>
            <div class="kpi-card bg-success-light" style="box-shadow: none; border: 1px solid var(--color-success);">
                <div class="kpi-label text-success">%KPI DT</div>
                <div class="kpi-value text-success" style="font-size: 18px; font-weight: 700; line-height: 1.25;">83.1%</div>
                <div class="kpi-sub text-success">‚ö†Ô∏è D∆∞·ªõi m·ª•c ti√™u</div>
            </div>
            <div class="kpi-card bg-warning-light" style="box-shadow: none; border: 1px solid var(--color-warning);">
                <div class="kpi-label text-warning">S·ª©c kh·ªèe t·∫≠p ƒëo√†n</div>
                <div class="kpi-value text-warning" style="font-size: 18px; font-weight: 700; line-height: 1.25;">‚ö†Ô∏è TRUNG B√åNH</div>
            </div>
        </div>

        <!-- Ranking -->
        <div class="card">
            <div class="card-title">T·ªïng quan</div>
            
            <div class="ranking-item">
                <div class="ranking-icon critical">
                    üö®
                </div>
                <div class="ranking-info">
                    <div class="ranking-name"><strong>S:</strong> Kh√¥ng ƒë·∫°t k·∫ø ho·∫°ch</div>
                    <div class="ranking-detail">
                        Doanh thu: 17.162 M (ƒë·∫°t 69.7% KPI)<br>
                        L·ª£i nhu·∫≠n: -243 M (chi·∫øm 6.75% doanh thu)
                    </div>
                </div>
            </div>
            
            <div class="ranking-item">
                <div class="ranking-icon excellent">
                    ‚úÖ
                </div>
                <div class="ranking-info">
                    <div class="ranking-name"><strong>T:</strong> Kh√¥ng ƒë·∫°t k·∫ø ho·∫°ch</div>
                    <div class="ranking-detail">
                        Doanh thu: 27.733 M (ƒë·∫°t 83.5% KPI)<br>
                        L·ª£i nhu·∫≠n: 434 M (chi·∫øm 24.74% doanh thu)
                    </div>
                </div>
            </div>
            
            <div class="ranking-item">
                <div class="ranking-icon average">
                    ‚ö†Ô∏è
                </div>
                <div class="ranking-info">
                    <div class="ranking-name"><strong>I:</strong> Kh√¥ng ƒë·∫°t k·∫ø ho·∫°ch</div>
                    <div class="ranking-detail">
                        Doanh thu: 21.489 M (ƒë·∫°t 96.1% KPI)<br>
                        L·ª£i nhu·∫≠n: 615 M (chi·∫øm 15.74% doanh thu)
                    </div>
                </div>
            </div>
            
            <button class="btn btn-outline" onclick="switchTab('tab-company')" style="margin-top: 12px;">Xem chi ti·∫øt theo c√¥ng ty ‚Üí</button>
        </div>

        <!-- Chart -->
        <div class="card">
            <div class="card-title">Doanh thu v√† l·ª£i nhu·∫≠n</div>
            <div id="chart-overview" style="height: 250px;"></div>
        </div>

        <!-- Quarterly Comparison Chart - Revenue -->
        <div class="card">
            <div class="card-title">So s√°nh doanh thu c√πng k·ª≥ 2024</div>
            <div id="chart-quarterly-comparison-overview" style="height: 250px;"></div>
        </div>

        <!-- Quarterly Comparison Chart - Profit -->
        <div class="card">
            <div class="card-title">So s√°nh l·ª£i nhu·∫≠n c√πng k·ª≥ 2024</div>
            <div id="chart-quarterly-pbt-comparison-overview" style="height: 250px;"></div>
        </div>

        <!-- Ph√¢n t√≠ch -->
        <div class="card">
            <div class="card-title">Ph√¢n t√≠ch</div>
            <div id="quarterly-analysis-overview" style="font-size: 14px; font-weight: 400; line-height: 1.25; color: var(--color-text-muted);">
                ...
            </div>
        </div>
    </div>

    <!-- TAB 2: THEO C√îNG TY -->
    <div id="tab-company" class="tab-content">
        <!-- Company Switcher -->
        <div class="segmented-control">
            <button class="segment-btn active" onclick="switchCompany('SAN')" data-company="SAN">S</button>
            <button class="segment-btn" onclick="switchCompany('TEENNIE')" data-company="TEENNIE">T</button>
            <button class="segment-btn" onclick="switchCompany('TGIL')" data-company="TGIL">I</button>
        </div>

        <!-- KPI Grid Dynamic -->
        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-label">Doanh thu 2025 YTD</div>
                <div class="kpi-value" id="comp-revenue">...</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">LN l≈©y k·∫ø</div>
                <div class="kpi-value" id="comp-cumulative">...</div>
                <div class="kpi-sub" id="comp-margin">...</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">%KPI</div>
                <div class="kpi-value" id="comp-plan">...</div>
                <div class="kpi-sub" id="comp-plan-sub">...</div>
            </div>
            <div class="kpi-card" id="comp-status-card">
                <div class="kpi-label">Tr·∫°ng th√°i</div>
                <div class="kpi-value" style="font-size: 17px; font-weight: 700; line-height: 1.25;" id="comp-status">...</div>
            </div>
        </div>

        <!-- Mini Chart -->
        <div class="card" style="overflow: hidden; width: 100%;">
            <div class="card-title">L·ª£i nhu·∫≠n lu·ªπ k·∫ø <span id="cumulative-final-label" style="font-size: 12px; font-weight: 400; color: var(--color-text-muted);"></span></div>
            <div id="chart-company" style="height: 264px; width: 100%; max-width: 100%; box-sizing: border-box;"></div>
        </div>

        <!-- Company Quarterly Comparison Chart - Revenue -->
        <div class="card">
            <div class="card-title">So s√°nh doanh thu c√πng k·ª≥ 2024</div>
            <div id="chart-company-quarterly-comparison" style="height: 300px;"></div>
        </div>

        <!-- Company Quarterly Comparison Chart - Profit -->
        <div class="card">
            <div class="card-title">So s√°nh l·ª£i nhu·∫≠n c√πng k·ª≥ 2024</div>
            <div id="chart-company-quarterly-pbt-comparison" style="height: 300px;"></div>
        </div>

        <!-- Action Buttons -->
        <button class="btn btn-outline" onclick="goToExpenseTab()">Xem chi ti·∫øt chi ph√≠ ‚Üí</button>
        <button class="btn btn-primary" onclick="goToActionTab()">Xem vi·ªác c·∫ßn l√†m 90 ng√†y ‚Üí</button>

        <!-- Ph√¢n t√≠ch -->
        <div class="card">
            <div class="card-title">Ph√¢n t√≠ch</div>
            <div id="quarterly-analysis-company" style="font-size: 14px; font-weight: 400; line-height: 1.25; color: var(--color-text-muted);">
                ...
            </div>
        </div>
    </div>

    <!-- TAB 3: CHI PH√ç & BI·∫æN ƒê·ªòNG -->
    <div id="tab-expense" class="tab-content">
        <div class="segmented-control">
            <button class="segment-btn active" onclick="switchExpenseCompany('SAN')" data-company="SAN">S</button>
            <button class="segment-btn" onclick="switchExpenseCompany('TEENNIE')" data-company="TEENNIE">T</button>
            <button class="segment-btn" onclick="switchExpenseCompany('TGIL')" data-company="TGIL">I</button>
        </div>
        
        <!-- Section 1: KPI Chips -->
        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-label">T·ªïng chi ph√≠ b√°n h√†ng</div>
                <div class="kpi-value" id="exp-selling-total">...</div>
                <div class="kpi-sub" id="exp-selling-avg">...</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">T·ªïng chi ph√≠ qu·∫£n l√Ω doanh nghi·ªáp</div>
                <div class="kpi-value" id="exp-admin-total">...</div>
                <div class="kpi-sub" id="exp-admin-avg">...</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">T·ªïng chi ph√≠ kh√°c</div>
                <div class="kpi-value" id="exp-other-total">...</div>
                <div class="kpi-sub" id="exp-other-avg">...</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">T·ªïng chi ph√≠ YTD</div>
                <div class="kpi-value" id="exp-total-ytd">...</div>
                <div class="kpi-sub" id="exp-total-avg">...</div>
            </div>
        </div>
        
        <!-- Section 2: Bi·ªÉu ƒë·ªì c·∫•u tr√∫c chi ph√≠ theo qu√Ω -->
        <div class="card" style="overflow-x: hidden;">
            <div class="card-title">So s√°nh c·∫•u tr√∫c chi ph√≠ theo qu√Ω v·ªõi nƒÉm 2024</div>
            <div id="chart-expense-structure-quarterly" style="height: 300px; width: 100%; max-width: 100%; box-sizing: border-box;"></div>
        </div>
        
        <!-- Section 3: Waterfall Charts theo qu√Ω 2025 -->
        <div class="card">
            <div class="card-title">C·∫•u tr√∫c chi ph√≠ - Qu√Ω 1</div>
            <div id="chart-expense-waterfall-q1" style="height: 280px;"></div>
        </div>
        
        <div class="card">
            <div class="card-title">C·∫•u tr√∫c chi ph√≠ - Qu√Ω 2</div>
            <div id="chart-expense-waterfall-q2" style="height: 280px;"></div>
        </div>
        
        <div class="card">
            <div class="card-title">C·∫•u tr√∫c chi ph√≠ - Qu√Ω 3</div>
            <div id="chart-expense-waterfall-q3" style="height: 280px;"></div>
        </div>
        
        <div class="card">
            <div class="card-title">C·∫•u tr√∫c chi ph√≠ - Qu√Ω 4</div>
            <div id="chart-expense-waterfall-q4" style="height: 280px;"></div>
        </div>
    </div>

    <!-- TAB 4: H√ÄNH ƒê·ªòNG -->
    <div id="tab-action" class="tab-content">
        <!-- Time Filters -->
        <div class="chips-container">
            <div class="chip active" onclick="filterAction('0-30', this)">0-30 ng√†y</div>
            <div class="chip" onclick="filterAction('30-60', this)">30-60 ng√†y</div>
            <div class="chip" onclick="filterAction('60-90', this)">60-90 ng√†y</div>
        </div>

        <div style="margin-bottom: 16px; font-size: 12px; font-weight: 400; line-height: 1.5; color: var(--color-text-muted); font-style: italic;" id="action-subtitle">
            ∆Øu ti√™n kh·∫©n c·∫•p: C·∫Øt gi·∫£m chi ph√≠ & ·ªîn ƒë·ªãnh
        </div>

        <!-- Dynamic Accordions -->
        <div id="action-list">
            <!-- Injected by JS -->
        </div>

        <div style="margin-top: 24px;">
            <button class="btn btn-primary">üì• T·∫£i k·∫ø ho·∫°ch (PDF)</button>
            <button class="btn btn-outline">Xem b√°o c√°o chi ti·∫øt (Desktop)</button>
        </div>
    </div>

    <!-- Bottom Nav -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('tab-overview')">
            <div class="nav-icon">üìä</div>
            <div class="nav-label">T·ªïng quan</div>
        </div>
        <div class="nav-item" onclick="switchTab('tab-company')">
            <div class="nav-icon">üè¢</div>
            <div class="nav-label">Doanh thu</div>
        </div>
        <div class="nav-item" onclick="switchTab('tab-expense')">
            <div class="nav-icon">üí∞</div>
            <div class="nav-label">Chi ph√≠</div>
        </div>
        <div class="nav-item" onclick="switchTab('tab-action')">
            <div class="nav-icon">üìã</div>
            <div class="nav-label">H√†nh ƒë·ªông</div>
        </div>
    </div>

    <!-- DATA & LOGIC -->
    <script>
        const companyData = [{"id": "SAN", "name": "S", "full_name": "SAN", "revenue": 17161.7, "pbt": -242.68, "margin": -6.75410944137236, "avg_achieve": 69.68333333333332, "status": "c\u1ea7n ch\u00fa \u00fd ngay", "status_short": "nghi\u00eam tr\u1ecdng", "status_class": "critical", "icon": "\ud83d\udea8", "expense_ratios": {"COGS": 30.53910743108201, "Selling": 29.578072102414097, "Admin": 42.54741663121952, "Other": 4.08951327665674}, "cv_data": {"COGS": 20.392026824010458, "Selling": 22.831682376052665, "Admin": 7.314908764061695, "Other": 73.23125047246401}, "monthly_pbt": [464.66, -236.48, -24.76, -140.9, -145.56, -188.0, -37.9, -303.73, -303.77, -242.68], "cumulative_pbt": [464.66, 228.18000000000004, 203.42000000000004, 62.52000000000004, -83.03999999999996, -271.03999999999996, -308.93999999999994, -612.67, -916.4399999999999, -1159.12], "quarterly_data": [{"quarter": "Q1", "revenue": 5770.39, "cogs": 1657.87, "selling_exp": 1571.6000000000001, "admin_exp": 2047.49, "other_exp": 290.01, "pbt": 203.42000000000004}, {"quarter": "Q2", "revenue": 5168.43, "cogs": 1715.6499999999999, "selling_exp": 1521.8500000000001, "admin_exp": 2194.99, "other_exp": 210.39000000000001, "pbt": -474.46000000000004}, {"quarter": "Q3", "revenue": 4414.83, "cogs": 1336.52, "selling_exp": 1393.1, "admin_exp": 2229.1899999999996, "other_exp": 101.43, "pbt": -645.4}, {"quarter": "Q4", "revenue": 1808.05, "cogs": 530.99, "selling_exp": 589.55, "admin_exp": 830.19, "other_exp": 100.0, "pbt": -242.68}], "insight": "- LN/DT -6.75%, kh\u00f4ng \u0111\u1ea1t k\u1ebf ho\u1ea1ch doanh thu (69.7%).<br>- C\u01a1 c\u1ea5u chi ph\u00ed b\u00e1n h\u00e0ng, qu\u1ea3n l\u00fd cao, \u1ea3nh h\u01b0\u1edfng m\u1ea1nh \u0111\u1ebfn l\u1ee3i nhu\u1eadn.", "expense_data": {"total_selling": 5076.1, "total_admin": 7301.860000000001, "total_other": 701.8299999999999, "total_ytd": 13079.79, "avg_monthly_selling": 507.61, "avg_monthly_admin": 730.186, "avg_monthly_other": 70.18299999999999, "avg_monthly_total": 1307.979, "quarterly_2025": {"selling": {"Q1": 1571.6000000000001, "Q2": 1521.8500000000001, "Q3": 1393.1, "Q4": 589.55}, "admin": {"Q1": 2047.49, "Q2": 2194.99, "Q3": 2229.1899999999996, "Q4": 830.19}, "other": {"Q1": 290.01, "Q2": 210.39000000000001, "Q3": 101.43, "Q4": 100.0}}, "quarterly_2024": {"selling": {"Q1": 2584.05, "Q2": 1701.8600000000001, "Q3": 2481.56, "Q4": 857.45}, "admin": {"Q1": 1810.54, "Q2": 1774.67, "Q3": 2023.65, "Q4": 662.92}, "other": {"Q1": 218.43, "Q2": 270.95000000000005, "Q3": 1096.24, "Q4": 115.42}}}}, {"id": "TEENNIE", "name": "T", "full_name": "TEENNIE", "revenue": 27732.76, "pbt": 434.07, "margin": 24.74084800791555, "avg_achieve": 83.50666666666667, "status": "ho\u1ea1t \u0111\u1ed9ng xu\u1ea5t s\u1eafc", "status_short": "xu\u1ea5t s\u1eafc", "status_class": "excellent", "icon": "\u2705", "expense_ratios": {"COGS": 7.933577472995836, "Selling": 39.40812237945304, "Admin": 27.346538894794463, "Other": 2.98693674917318}, "cv_data": {"COGS": 34.31400073767651, "Selling": 27.438497870568884, "Admin": 7.343833221715429, "Other": 69.48280489043562}, "monthly_pbt": [435.78, 635.29, 714.36, 613.24, 500.33, 958.9, 1094.36, 648.33, 826.66, 434.07], "cumulative_pbt": [435.78, 1071.07, 1785.4299999999998, 2398.67, 2899.0, 3857.9, 4952.26, 5600.59, 6427.25, 6861.32], "quarterly_data": [{"quarter": "Q1", "revenue": 6996.0, "cogs": 403.84000000000003, "selling_exp": 2388.79, "admin_exp": 2198.15, "other_exp": 219.79, "pbt": 1785.4299999999998}, {"quarter": "Q2", "revenue": 8532.880000000001, "cogs": 772.9599999999999, "selling_exp": 3108.8500000000004, "admin_exp": 2204.2000000000003, "other_exp": 374.39, "pbt": 2072.47}, {"quarter": "Q3", "revenue": 9123.11, "cogs": 767.8, "selling_exp": 3951.96, "admin_exp": 2375.41, "other_exp": 128.63, "pbt": 2569.35}, {"quarter": "Q4", "revenue": 3080.77, "cogs": 255.6, "selling_exp": 1479.36, "admin_exp": 806.19, "other_exp": 105.55, "pbt": 434.07}], "insight": "- LN/DT 24.74%, \u0111\u1ea1t 83.5% k\u1ebf ho\u1ea1ch.<br>- T\u1ef7 su\u1ea5t kh\u1ecfe, l\u00e0 \u0111\u1ea7u t\u00e0u l\u1ee3i nhu\u1eadn.", "expense_data": {"total_selling": 10928.960000000001, "total_admin": 7583.950000000001, "total_other": 828.3599999999999, "total_ytd": 19341.270000000004, "avg_monthly_selling": 1092.8960000000002, "avg_monthly_admin": 758.3950000000001, "avg_monthly_other": 82.83599999999998, "avg_monthly_total": 1934.1270000000004, "quarterly_2025": {"selling": {"Q1": 2388.79, "Q2": 3108.8500000000004, "Q3": 3951.96, "Q4": 1479.36}, "admin": {"Q1": 2198.15, "Q2": 2204.2000000000003, "Q3": 2375.41, "Q4": 806.19}, "other": {"Q1": 219.79, "Q2": 374.39, "Q3": 128.63, "Q4": 105.55}}, "quarterly_2024": {"selling": {"Q1": 2402.1400000000003, "Q2": 2932.4700000000003, "Q3": 3266.0299999999997, "Q4": 1074.55}, "admin": {"Q1": 1803.8100000000002, "Q2": 2052.7000000000003, "Q3": 2162.75, "Q4": 721.58}, "other": {"Q1": 65.96000000000001, "Q2": 168.73, "Q3": 151.24, "Q4": 78.6}}}}, {"id": "TGIL", "name": "I", "full_name": "TGIL", "revenue": 21488.640000000003, "pbt": 614.92, "margin": 15.739292947343337, "avg_achieve": 96.10000000000001, "status": "c\u1ea7n \u1ed5n \u0111\u1ecbnh", "status_short": "trung b\u00ecnh", "status_class": "average", "icon": "\u26a0\ufe0f", "expense_ratios": {"COGS": 19.31201788479866, "Selling": 27.666711341434354, "Admin": 35.57340064331665, "Other": 5.273716717298069}, "cv_data": {"COGS": 26.666683386539404, "Selling": 24.45329033522549, "Admin": 6.827251830582928, "Other": 47.604052265115996}, "monthly_pbt": [30.0, -202.95, 880.08, 156.17, 397.46, 493.94, 89.07, 816.85, 106.62, 614.92], "cumulative_pbt": [30.0, -172.95, 707.1300000000001, 863.3000000000001, 1260.76, 1754.7, 1843.77, 2660.62, 2767.24, 3382.16], "quarterly_data": [{"quarter": "Q1", "revenue": 5919.66, "cogs": 1178.8, "selling_exp": 1574.94, "admin_exp": 2145.2799999999997, "other_exp": 313.5, "pbt": 707.1300000000001}, {"quarter": "Q2", "revenue": 6815.040000000001, "cogs": 1296.93, "selling_exp": 1688.6799999999998, "admin_exp": 2317.8500000000004, "other_exp": 463.99, "pbt": 1047.57}, {"quarter": "Q3", "revenue": 5871.039999999999, "cogs": 1172.76, "selling_exp": 1869.13, "admin_exp": 2332.5299999999997, "other_exp": 250.21, "pbt": 1012.5400000000001}, {"quarter": "Q4", "revenue": 2882.9, "cogs": 501.4, "selling_exp": 812.45, "admin_exp": 848.58, "other_exp": 105.55, "pbt": 614.92}], "insight": "- LN/DT 15.74%, nh\u01b0ng chi ph\u00ed bi\u1ebfn \u0111\u1ed9ng.<br>- C\u1ea7n \u1ed5n \u0111\u1ecbnh v\u1eadn h\u00e0nh v\u00e0 ki\u1ec3m so\u00e1t chi ph\u00ed.", "expense_data": {"total_selling": 5945.2, "total_admin": 7644.24, "total_other": 1133.25, "total_ytd": 14722.689999999999, "avg_monthly_selling": 594.52, "avg_monthly_admin": 764.424, "avg_monthly_other": 113.325, "avg_monthly_total": 1472.2689999999998, "quarterly_2025": {"selling": {"Q1": 1574.94, "Q2": 1688.6799999999998, "Q3": 1869.13, "Q4": 812.45}, "admin": {"Q1": 2145.2799999999997, "Q2": 2317.8500000000004, "Q3": 2332.5299999999997, "Q4": 848.58}, "other": {"Q1": 313.5, "Q2": 463.99, "Q3": 250.21, "Q4": 105.55}}, "quarterly_2024": {"selling": {"Q1": 1234.53, "Q2": 1456.08, "Q3": 2124.08, "Q4": 739.53}, "admin": {"Q1": 1737.6799999999998, "Q2": 1916.65, "Q3": 2050.99, "Q4": 674.56}, "other": {"Q1": 477.61, "Q2": 504.69, "Q3": 216.36, "Q4": 91.37}}}}];
        const actionPlans = {"0-30": {"SAN": ["Ki\u1ec3m to\u00e1n chi ph\u00ed to\u00e0n di\u1ec7n & c\u1eaft gi\u1ea3m kh\u1ea9n c\u1ea5p", "R\u00e0 so\u00e1t chi ph\u00ed lab & h\u1ee3p \u0111\u1ed3ng nh\u00e0 cung c\u1ea5p", "Ph\u00e2n t\u00edch ROI marketing & c\u1eaft k\u00eanh k\u00e9m hi\u1ec7u qu\u1ea3", "\u0110\u00e1nh gi\u00e1 n\u0103ng su\u1ea5t & si\u1ebft ki\u1ec3m so\u00e1t chi ph\u00ed v\u1eadn h\u00e0nh"], "TEENNIE": ["R\u00e0 so\u00e1t chi ph\u00ed t\u0103ng \u0111\u1ed9t bi\u1ebfn Qu\u00fd 2", "Chu\u1ea9n b\u1ecb k\u1ebf ho\u1ea1ch m\u1edf r\u1ed9ng"], "TGIL": ["Ph\u00e2n t\u00edch nguy\u00ean nh\u00e2n g\u1ed1c r\u1ec5 bi\u1ebfn \u0111\u1ed9ng chi ph\u00ed", "R\u00e0 so\u00e1t qu\u1ea3n tr\u1ecb t\u1ed3n kho & nh\u00e0 cung c\u1ea5p"], "GROUP": ["Th\u01b0\u01a1ng l\u01b0\u1ee3ng l\u1ea1i h\u1ee3p \u0111\u1ed3ng cung c\u1ea5p cho to\u00e0n t\u1eadp \u0111o\u00e0n", "Tri\u1ec3n khai b\u00e1o c\u00e1o qu\u1ea3n l\u00fd h\u00e0ng th\u00e1ng"]}, "30-60": {"SAN": ["Kh\u1edfi \u0111\u1ed9ng c\u00e1c s\u00e1ng ki\u1ebfn ph\u1ee5c h\u1ed3i doanh thu"], "TEENNIE": ["X\u00e2y d\u1ef1ng v\u00e0 ph\u00ea duy\u1ec7t k\u1ebf ho\u1ea1ch m\u1edf r\u1ed9ng"], "TGIL": ["Tri\u1ec3n khai quy tr\u00ecnh ph\u00ea duy\u1ec7t chi ph\u00ed", "T\u1eadp trung mua h\u00e0ng n\u1ebfu c\u00f3 th\u1ec3"], "GROUP": ["Tri\u1ec3n khai quy tr\u00ecnh ph\u00ea duy\u1ec7t chi ph\u00ed t\u1eadp \u0111o\u00e0n"]}, "60-90": {"SAN": ["\u0110\u00e1nh gi\u00e1 ti\u1ebfn \u0111\u1ed9 chuy\u1ec3n h\u01b0\u1edbng, \u0111\u01b0a ra quy\u1ebft \u0111\u1ecbnh chi\u1ebfn l\u01b0\u1ee3c"], "TEENNIE": ["Th\u1ef1c hi\u1ec7n \u0111\u1ea7u t\u01b0 t\u0103ng tr\u01b0\u1edfng"], "TGIL": ["Tri\u1ec3n khai c\u00e1c bi\u1ec7n ph\u00e1p \u1ed5n \u0111\u1ecbnh ho\u1ea1t \u0111\u1ed9ng"], "GROUP": ["R\u00e0 so\u00e1t v\u00e0 \u0111\u1eb7t l\u1ea1i m\u1ee5c ti\u00eau Qu\u00fd 4 d\u1ef1a tr\u00ean b\u00e0i h\u1ecdc kinh nghi\u1ec7m"]}};
        const quarterlyComparison = {"2024": {"revenue": {"Q1": 16993.86, "Q2": 15543.41, "Q3": 20371.05, "Q4": 6224.66}, "pbt": {"Q1": 1175.29, "Q2": 212.89, "Q3": 1342.81, "Q4": -138.95}}, "2025": {"revenue": {"Q1": 18686.03, "Q2": 20516.35, "Q3": 19408.97, "Q4": 7771.72}, "pbt": {"Q1": 2695.99, "Q2": 2645.58, "Q3": 2936.48, "Q4": 806.31}}};
        const quarterlyCompanyComparison = {"SAN": {"2024": {"revenue": {"Q1": 7237.93, "Q2": 5396.95, "Q3": 7473.51, "Q4": 2126.02}, "pbt": {"Q1": 720.1999999999999, "Q2": 589.1800000000001, "Q3": 268.54, "Q4": -234.02}}, "2025": {"revenue": {"Q1": 5770.39, "Q2": 5168.43, "Q3": 4414.83, "Q4": 1808.05}, "pbt": {"Q1": 203.42000000000004, "Q2": -474.46000000000004, "Q3": -645.4, "Q4": -242.68}}}, "TEENNIE": {"2024": {"revenue": {"Q1": 4700.6, "Q2": 5436.58, "Q3": 7599.38, "Q4": 2266.51}, "pbt": {"Q1": 24.449999999999978, "Q2": -187.23, "Q3": 1319.8200000000002, "Q4": 99.2}}, "2025": {"revenue": {"Q1": 6996.0, "Q2": 8532.880000000001, "Q3": 9123.11, "Q4": 3080.77}, "pbt": {"Q1": 1785.4299999999998, "Q2": 2072.47, "Q3": 2569.35, "Q4": 434.07}}}, "TGIL": {"2024": {"revenue": {"Q1": 5055.33, "Q2": 4709.88, "Q3": 5298.16, "Q4": 1832.13}, "pbt": {"Q1": 430.64000000000004, "Q2": -189.05999999999997, "Q3": -245.54999999999998, "Q4": -4.13}}, "2025": {"revenue": {"Q1": 5919.66, "Q2": 6815.040000000001, "Q3": 5871.039999999999, "Q4": 2882.9}, "pbt": {"Q1": 707.1300000000001, "Q2": 1047.57, "Q3": 1012.5400000000001, "Q4": 614.92}}}};
        let currentCompanyId = 'SAN';
        let currentExpenseCompanyId = 'SAN';
        let currentTimeframe = '0-30';

        // --- INIT ---
        // Kh·ªüi t·∫°o khi DOM ready
        document.addEventListener('DOMContentLoaded', () => {
            renderOverviewChart();
            renderQuarterlyComparisonChartOverview();
            renderQuarterlyPBTComparisonChartOverview();
            updateQuarterlyAnalysisOverview();
            // Kh·ªüi t·∫°o tab Chi ph√≠
            updateExpenseTab('SAN');
            renderActions('0-30');
            
            // ƒê·ª£i m·ªôt ch√∫t ƒë·ªÉ ƒë·∫£m b·∫£o layout ƒë√£ render xong, sau ƒë√≥ c·∫≠p nh·∫≠t tab company
            setTimeout(() => {
                // ƒê·∫£m b·∫£o tab company ƒë∆∞·ª£c hi·ªÉn th·ªã t·∫°m th·ªùi ƒë·ªÉ render bi·ªÉu ƒë·ªì
                const companyTab = document.getElementById('tab-company');
                const wasVisible = companyTab.classList.contains('active');
                if (!wasVisible) {
                    companyTab.classList.add('active');
                }
                updateCompanyTab('SAN');
                if (!wasVisible) {
                    companyTab.classList.remove('active');
                    document.getElementById('tab-overview').classList.add('active');
                }
            }, 150);
        });

        // --- NAVIGATION ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            event.currentTarget.classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // N·∫øu chuy·ªÉn sang tab company, c·∫≠p nh·∫≠t l·∫°i d·ªØ li·ªáu v√† resize bi·ªÉu ƒë·ªì sau khi tab ƒë∆∞·ª£c hi·ªÉn th·ªã
            if (tabId === 'tab-company') {
                setTimeout(() => {
                    updateCompanyTab(currentCompanyId);
                    Plotly.Plots.resize('chart-company');
                    Plotly.Plots.resize('chart-company-quarterly-comparison');
                    Plotly.Plots.resize('chart-company-quarterly-pbt-comparison');
                }, 200);
            }
            
            // N·∫øu chuy·ªÉn sang tab overview, resize bi·ªÉu ƒë·ªì sau khi tab ƒë∆∞·ª£c hi·ªÉn th·ªã
            if (tabId === 'tab-overview') {
                setTimeout(() => {
                    Plotly.Plots.resize('chart-overview');
                    Plotly.Plots.resize('chart-quarterly-comparison-overview');
                    Plotly.Plots.resize('chart-quarterly-pbt-comparison-overview');
                }, 200);
            }
            
            // N·∫øu chuy·ªÉn sang tab expense, c·∫≠p nh·∫≠t l·∫°i d·ªØ li·ªáu v√† resize bi·ªÉu ƒë·ªì sau khi tab ƒë∆∞·ª£c hi·ªÉn th·ªã
            if (tabId === 'tab-expense') {
                setTimeout(() => {
                    updateExpenseTab(currentExpenseCompanyId);
                    Plotly.Plots.resize('chart-expense-structure-quarterly');
                    Plotly.Plots.resize('chart-expense-waterfall-q1');
                    Plotly.Plots.resize('chart-expense-waterfall-q2');
                    Plotly.Plots.resize('chart-expense-waterfall-q3');
                    Plotly.Plots.resize('chart-expense-waterfall-q4');
                }, 200);
            }
        }

        function goToExpenseTab() {
            switchTab('tab-expense');
            // Simulate click on nav item
            document.querySelectorAll('.nav-item')[2].classList.add('active');
            document.querySelectorAll('.nav-item')[1].classList.remove('active');
        }

        function goToActionTab() {
            switchTab('tab-action');
            document.querySelectorAll('.nav-item')[3].classList.add('active');
            document.querySelectorAll('.nav-item')[1].classList.remove('active');
        }

        // --- TAB 2: COMPANY ---
        function switchCompany(compId) {
            currentCompanyId = compId;
            updateCompanyTab(compId);
            
            // Update active state of buttons
            document.querySelectorAll('#tab-company .segment-btn').forEach(btn => {
                btn.classList.remove('active');
                if(btn.getAttribute('data-company') === compId) 
                    btn.classList.add('active');
            });
            
            // Resize bi·ªÉu ƒë·ªì sau khi chuy·ªÉn c√¥ng ty
            setTimeout(() => {
                Plotly.Plots.resize('chart-company');
                Plotly.Plots.resize('chart-company-quarterly-comparison');
                Plotly.Plots.resize('chart-company-quarterly-pbt-comparison');
            }, 100);
        }

        function updateCompanyTab(compId) {
            const data = companyData.find(c => c.id === compId);
            if (!data) return;

            // KPI
            document.getElementById('comp-revenue').textContent = formatNumber(data.revenue);
            // L·ª£i nhu·∫≠n lu·ªπ k·∫ø (th√°ng 10, index 9)
            const cumulativeValue = data.cumulative_pbt[9];
            document.getElementById('comp-cumulative').textContent = formatNumber(cumulativeValue);
            document.getElementById('comp-margin').textContent = `LN/DT: ${data.margin.toFixed(2)}%`;
            
            // B·ªï sung label LN l≈©y k·∫ø cu·ªëi c√πng
            document.getElementById('cumulative-final-label').textContent = `(${formatNumber(cumulativeValue)})`;
            
            document.getElementById('comp-plan').textContent = `${data.avg_achieve.toFixed(1)}%`;
            document.getElementById('comp-plan-sub').textContent = data.avg_achieve >= 100 ? '‚úÖ V∆∞·ª£t m·ª•c ti√™u' : data.avg_achieve < 90 ? '‚ö†Ô∏è D∆∞·ªõi m·ª•c ti√™u' : '‚û°Ô∏è ƒê·∫°t m·ª•c ti√™u';
            
            const statusEl = document.getElementById('comp-status');
            const statusCard = document.getElementById('comp-status-card');
            statusEl.textContent = data.status;
            
            // Styling status card
            statusCard.className = 'kpi-card'; // reset
            if (data.status_class === 'critical') statusCard.classList.add('bg-danger-light', 'text-danger');
            else if (data.status_class === 'excellent') statusCard.classList.add('bg-success-light', 'text-success');
            else statusCard.classList.add('bg-warning-light', 'text-warning');

            // Chart: L·ª£i nhu·∫≠n lu·ªπ k·∫ø c·ªßa c√¥ng ty ƒëang ch·ªçn
            const months = ["T01", "T02", "T03", "T04", "T05", "T06", "T07", "T08", "T09", "T10"];
            const chartColor = data.status_class === 'critical' ? '#E03A3E' : data.status_class === 'excellent' ? '#0FA958' : '#F5A623';
            
            // T√≠nh to√°n min/max cho yaxis v·ªõi padding
            const allValues = [...data.monthly_pbt, ...data.cumulative_pbt];
            const dataMin = Math.min(...allValues);
            const dataMax = Math.max(...allValues);
            const range = dataMax - dataMin;
            
            // Th√™m padding 15% cho ph·∫ßn d∆∞∆°ng v√† √¢m, sau ƒë√≥ tƒÉng th√™m 20% cho range
            let yMin = dataMin - (range * 0.15);
            let yMax = dataMax + (range * 0.15);
            // TƒÉng range l√™n 20%
            const rangePadding = (yMax - yMin) * 0.2;
            yMin = yMin - rangePadding;
            yMax = yMax + rangePadding;
            // Gi·∫£m max axis 15% v√¨ b√™n tr√™n nh√¨n tr·ªëng qu√°
            yMax = yMax - (yMax - yMin) * 0.15;
            
            // ƒê·∫£m b·∫£o c√≥ kho·∫£ng tr·ªëng t·ªëi thi·ªÉu n·∫øu d·ªØ li·ªáu qu√° nh·ªè
            if (Math.abs(dataMin) < 1 && Math.abs(dataMax) < 1) {
                yMin = Math.min(yMin, -1);
                yMax = Math.max(yMax, 1);
            }
            
            // Trace 1: C·ªôt l·ª£i nhu·∫≠n h√†ng th√°ng
            const traceBar = {
                x: months,
                y: data.monthly_pbt,
                type: 'bar',
                name: 'L·ª£i nhu·∫≠n h√†ng th√°ng',
                marker: { 
                    color: chartColor,
                    opacity: 0.7,
                    line: { color: 'white', width: 0.5 }
                },
                text: data.monthly_pbt.map(v => formatNumber(v)),
                textposition: 'outside',
                textfont: { 
                    size: 9, 
                    color: chartColor
                }
            };
            
            // Trace 2: ƒê∆∞·ªùng l·ª£i nhu·∫≠n lu·ªπ k·∫ø (m∆∞·ª£t v√† m·ªèng h∆°n)
            const traceLine = {
                x: months,
                y: data.cumulative_pbt,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'L·ª£i nhu·∫≠n lu·ªπ k·∫ø',
                line: { 
                    color: chartColor,
                    width: 2, // Gi·∫£m ƒë·ªô d√†y t·ª´ 3 xu·ªëng 2
                    shape: 'spline', // L√†m m∆∞·ª£t
                    smoothing: 1.3
                },
                marker: {
                    size: 5,
                    color: chartColor
                }
            };
            
            // Annotation cho th√°ng cu·ªëi c√πng (th√°ng 10, index 9)
            const lastMonthIndex = months.length - 1;
            const lastMonth = months[lastMonthIndex];
            const lastCumulativeValue = data.cumulative_pbt[lastMonthIndex];
            
            const annotations = [
                {
                    x: lastMonth,
                    y: lastCumulativeValue,
                    text: formatNumber(lastCumulativeValue),
                    showarrow: true,
                    arrowhead: 2,
                    arrowsize: 1,
                    arrowwidth: 2,
                    arrowcolor: chartColor,
                    ax: 0,
                    ay: -30,
                    font: { color: chartColor, size: 10 },
                    bgcolor: 'rgba(255, 255, 255, 0.8)',
                    bordercolor: chartColor,
                    borderwidth: 1
                }
            ];
            
            const layout = {
                margin: { t: 10, b: 10, l: 10, r: 10 },
                xaxis: { 
                    title: '',
                    tickangle: -45,
                    tickfont: { size: 9 },
                    fixedrange: true
                },
                yaxis: {
                    title: '',
                    titlefont: { size: 10 },
                    tickfont: { size: 9 },
                    zeroline: true,
                    zerolinecolor: '#D1D5DB',
                    zerolinewidth: 1,
                    range: [yMin, yMax],
                    fixedrange: true,
                    showticklabels: false
                },
                legend: {
                    orientation: 'h',
                    y: -0.2,
                    x: 0.5,
                    xanchor: 'center',
                    font: { size: 9 }
                },
                height: 264,
                hovermode: 'x unified',
                dragmode: false,
                autosize: true,
                annotations: annotations
            };
            
            Plotly.newPlot('chart-company', [traceBar, traceLine], layout, {staticPlot: false, responsive: true, displayModeBar: false});
            
            // Render company quarterly comparison chart
            renderCompanyQuarterlyComparisonChart(compId);
            renderCompanyQuarterlyPBTComparisonChart(compId);
            
            // Update company analysis section
            updateCompanyQuarterlyAnalysis(compId);
        }

        // Render quarterly comparison chart for Overview tab (2024 vs 2025 - Total)
        function renderQuarterlyComparisonChartOverview() {
            if (!quarterlyComparison || !quarterlyComparison['2024'] || !quarterlyComparison['2025']) return;
            
            const quarters = ['Q1', 'Q2', 'Q3', 'Q4'];
            const revenue2024 = quarters.map(q => quarterlyComparison['2024'].revenue[q]);
            const revenue2025 = quarters.map(q => quarterlyComparison['2025'].revenue[q]);
            
            // T√≠nh to√°n tickvals v√† ticktext cho yaxis
            const maxValue = Math.max(...revenue2024, ...revenue2025);
            const minValue = Math.min(...revenue2024, ...revenue2025);
            const range = maxValue - minValue;
            const tickStep = range > 100000 ? 40000 : range > 50000 ? 20000 : 10000;
            const startTick = Math.floor(minValue / tickStep) * tickStep;
            // TƒÉng endTick l√™n 10% ƒë·ªÉ c√≥ th√™m kh√¥ng gian cho label
            const endTick = Math.ceil(maxValue / tickStep) * tickStep;
            const endTickWithPadding = endTick + (endTick - startTick) * 0.1;
            const tickvals = [];
            const ticktext = [];
            for (let i = startTick; i <= endTickWithPadding; i += tickStep) {
                tickvals.push(i);
                ticktext.push(i.toLocaleString('vi-VN') + ' M');
            }
            
            // Trace 1: Doanh thu 2024
            const trace2024 = {
                x: quarters,
                y: revenue2024,
                type: 'bar',
                name: '2024',
                marker: { 
                    color: '#94A3B8',
                    opacity: 0.7
                },
                text: revenue2024.map(v => formatNumber(v)),
                textposition: 'outside',
                textfont: { 
                    size: 10, 
                    color: '#94A3B8'
                },
                yaxis: 'y'
            };
            
            // Trace 2: Doanh thu 2025
            const trace2025 = {
                x: quarters,
                y: revenue2025,
                type: 'bar',
                name: '2025',
                marker: { 
                    color: '#1F6FEB',
                    opacity: 0.8
                },
                text: revenue2025.map(v => formatNumber(v)),
                textposition: 'outside',
                textfont: { 
                    size: 10, 
                    color: '#1F6FEB'
                },
                yaxis: 'y'
            };
            
            const layout = {
                margin: { t: 10, b: 10, l: 10, r: 10 },
                xaxis: { 
                    title: '',
                    tickfont: { size: 11 },
                    showgrid: false,
                    fixedrange: true
                },
                yaxis: {
                    title: '',
                    titlefont: { size: 11 },
                    tickfont: { size: 10 },
                    showgrid: true,
                    gridcolor: '#E1E4EB',
                    tickmode: 'array',
                    tickvals: tickvals,
                    ticktext: ticktext,
                    showticklabels: false,
                    range: [startTick, endTickWithPadding],
                    fixedrange: true
                },
                showlegend: true,
                legend: {
                    orientation: 'h',
                    y: -0.25,
                    x: 0.5,
                    xanchor: 'center',
                    font: { size: 11 }
                },
                height: 250,
                barmode: 'group',
                hovermode: 'x unified',
                dragmode: false
            };
            
            Plotly.newPlot('chart-quarterly-comparison-overview', [trace2024, trace2025], layout, {staticPlot: false, responsive: true, displayModeBar: false});
        }

        // Render quarterly PBT comparison chart for Overview tab (2024 vs 2025 - Total)
        function renderQuarterlyPBTComparisonChartOverview() {
            if (!quarterlyComparison || !quarterlyComparison['2024'] || !quarterlyComparison['2025']) return;
            
            const quarters = ['Q1', 'Q2', 'Q3', 'Q4'];
            const pbt2024 = quarters.map(q => quarterlyComparison['2024'].pbt[q]);
            const pbt2025 = quarters.map(q => quarterlyComparison['2025'].pbt[q]);
            
            // T√≠nh to√°n tickvals v√† ticktext cho yaxis
            const maxValue = Math.max(...pbt2024, ...pbt2025);
            const minValue = Math.min(...pbt2024, ...pbt2025);
            const range = maxValue - minValue;
            const tickStep = range > 10000 ? 4000 : range > 5000 ? 2000 : 1000;
            // Th√™m padding 10% cho c·∫£ min v√† max ƒë·ªÉ tr√°nh che khu·∫•t s·ªë
            const padding = range * 0.1;
            const startTick = Math.floor((minValue - padding) / tickStep) * tickStep;
            const endTick = Math.ceil((maxValue + padding) / tickStep) * tickStep;
            const tickvals = [];
            const ticktext = [];
            for (let i = startTick; i <= endTick; i += tickStep) {
                tickvals.push(i);
                ticktext.push(i.toLocaleString('vi-VN') + ' M');
            }
            
            // Trace 1: L·ª£i nhu·∫≠n 2024
            const trace2024 = {
                x: quarters,
                y: pbt2024,
                type: 'bar',
                name: '2024',
                marker: { 
                    color: '#94A3B8',
                    opacity: 0.7
                },
                text: pbt2024.map(v => formatNumber(v)),
                textposition: 'outside',
                textfont: { 
                    size: 10, 
                    color: '#94A3B8'
                },
                yaxis: 'y'
            };
            
            // Trace 2: L·ª£i nhu·∫≠n 2025
            const trace2025 = {
                x: quarters,
                y: pbt2025,
                type: 'bar',
                name: '2025',
                marker: { 
                    color: '#1F6FEB',
                    opacity: 0.8
                },
                text: pbt2025.map(v => formatNumber(v)),
                textposition: 'outside',
                textfont: { 
                    size: 10, 
                    color: '#1F6FEB'
                },
                yaxis: 'y'
            };
            
            const layout = {
                margin: { t: 10, b: 10, l: 10, r: 10 },
                xaxis: { 
                    title: '',
                    tickfont: { size: 11 },
                    showgrid: false,
                    fixedrange: true
                },
                yaxis: {
                    title: '',
                    titlefont: { size: 11 },
                    tickfont: { size: 10 },
                    showgrid: true,
                    gridcolor: '#E1E4EB',
                    tickmode: 'array',
                    tickvals: tickvals,
                    ticktext: ticktext,
                    showticklabels: false,
                    range: [startTick, endTick],
                    fixedrange: true
                },
                showlegend: true,
                legend: {
                    orientation: 'h',
                    y: -0.25,
                    x: 0.5,
                    xanchor: 'center',
                    font: { size: 11 }
                },
                height: 250,
                barmode: 'group',
                hovermode: 'x unified',
                dragmode: false
            };
            
            Plotly.newPlot('chart-quarterly-pbt-comparison-overview', [trace2024, trace2025], layout, {staticPlot: false, responsive: true, displayModeBar: false});
        }

        // Render company quarterly comparison chart (2024 vs 2025 - for each company)
        function renderCompanyQuarterlyComparisonChart(compId) {
            if (!quarterlyCompanyComparison || !quarterlyCompanyComparison[compId] || !quarterlyCompanyComparison[compId]['2024'] || !quarterlyCompanyComparison[compId]['2025']) return;
            
            const quarters = ['Q1', 'Q2', 'Q3', 'Q4'];
            const revenue2024 = quarters.map(q => quarterlyCompanyComparison[compId]['2024'].revenue[q]);
            const revenue2025 = quarters.map(q => quarterlyCompanyComparison[compId]['2025'].revenue[q]);
            
            // T√≠nh to√°n tickvals v√† ticktext cho yaxis
            const maxValue = Math.max(...revenue2024, ...revenue2025);
            const minValue = Math.min(...revenue2024, ...revenue2025);
            const range = maxValue - minValue;
            const tickStep = range > 100000 ? 40000 : range > 50000 ? 20000 : 10000;
            const startTick = Math.floor(minValue / tickStep) * tickStep;
            // TƒÉng endTick l√™n 20% ƒë·ªÉ c√≥ th√™m kh√¥ng gian cho label, sau ƒë√≥ gi·∫£m 15% v√¨ b√™n tr√™n nh√¨n tr·ªëng qu√°
            const endTick = Math.ceil(maxValue / tickStep) * tickStep;
            let endTickWithPadding = endTick + (endTick - startTick) * 0.2;
            // Gi·∫£m max axis 15%
            endTickWithPadding = endTickWithPadding - (endTickWithPadding - startTick) * 0.15;
            const tickvals = [];
            const ticktext = [];
            for (let i = startTick; i <= endTickWithPadding; i += tickStep) {
                tickvals.push(i);
                ticktext.push(i.toLocaleString('vi-VN') + ' M');
            }
            
            // Trace 1: Doanh thu 2024
            const trace2024 = {
                x: quarters,
                y: revenue2024,
                type: 'bar',
                name: '2024',
                marker: { 
                    color: '#94A3B8',
                    opacity: 0.7
                },
                text: revenue2024.map(v => formatNumber(v)),
                textposition: 'outside',
                textfont: { 
                    size: 10, 
                    color: '#94A3B8'
                },
                yaxis: 'y'
            };
            
            // Trace 2: Doanh thu 2025
            const trace2025 = {
                x: quarters,
                y: revenue2025,
                type: 'bar',
                name: '2025',
                marker: { 
                    color: '#1F6FEB',
                    opacity: 0.8
                },
                text: revenue2025.map(v => formatNumber(v)),
                textposition: 'outside',
                textfont: { 
                    size: 10, 
                    color: '#1F6FEB'
                },
                yaxis: 'y'
            };
            
            const layout = {
                margin: { t: 10, b: 10, l: 10, r: 10 },
                xaxis: { 
                    title: '',
                    tickfont: { size: 11 },
                    showgrid: false,
                    fixedrange: true
                },
                yaxis: {
                    title: '',
                    titlefont: { size: 11 },
                    tickfont: { size: 10 },
                    showgrid: true,
                    gridcolor: '#E1E4EB',
                    tickmode: 'array',
                    tickvals: tickvals,
                    ticktext: ticktext,
                    showticklabels: false,
                    range: [startTick, endTickWithPadding],
                    fixedrange: true
                },
                showlegend: true,
                legend: {
                    orientation: 'h',
                    y: -0.25,
                    x: 0.5,
                    xanchor: 'center',
                    font: { size: 11 }
                },
                height: 300,
                barmode: 'group',
                hovermode: 'x unified',
                dragmode: false
            };
            
            Plotly.newPlot('chart-company-quarterly-comparison', [trace2024, trace2025], layout, {staticPlot: false, responsive: true, displayModeBar: false});
        }

        // Render company quarterly PBT comparison chart (2024 vs 2025 - for each company)
        function renderCompanyQuarterlyPBTComparisonChart(compId) {
            if (!quarterlyCompanyComparison || !quarterlyCompanyComparison[compId] || !quarterlyCompanyComparison[compId]['2024'] || !quarterlyCompanyComparison[compId]['2025']) return;
            
            const quarters = ['Q1', 'Q2', 'Q3', 'Q4'];
            const pbt2024 = quarters.map(q => quarterlyCompanyComparison[compId]['2024'].pbt[q]);
            const pbt2025 = quarters.map(q => quarterlyCompanyComparison[compId]['2025'].pbt[q]);
            
            // T√≠nh to√°n tickvals v√† ticktext cho yaxis
            const maxValue = Math.max(...pbt2024, ...pbt2025);
            const minValue = Math.min(...pbt2024, ...pbt2025);
            const range = maxValue - minValue;
            const tickStep = range > 10000 ? 4000 : range > 5000 ? 2000 : 1000;
            // Th√™m padding 10% cho c·∫£ min v√† max ƒë·ªÉ tr√°nh che khu·∫•t s·ªë
            const padding = range * 0.1;
            const startTick = Math.floor((minValue - padding) / tickStep) * tickStep;
            const endTick = Math.ceil((maxValue + padding) / tickStep) * tickStep;
            const tickvals = [];
            const ticktext = [];
            for (let i = startTick; i <= endTick; i += tickStep) {
                tickvals.push(i);
                ticktext.push(i.toLocaleString('vi-VN') + ' M');
            }
            
            // Trace 1: L·ª£i nhu·∫≠n 2024
            const trace2024 = {
                x: quarters,
                y: pbt2024,
                type: 'bar',
                name: '2024',
                marker: { 
                    color: '#94A3B8',
                    opacity: 0.7
                },
                text: pbt2024.map(v => formatNumber(v)),
                textposition: 'outside',
                textfont: { 
                    size: 10, 
                    color: '#94A3B8'
                },
                yaxis: 'y'
            };
            
            // Trace 2: L·ª£i nhu·∫≠n 2025
            const trace2025 = {
                x: quarters,
                y: pbt2025,
                type: 'bar',
                name: '2025',
                marker: { 
                    color: '#1F6FEB',
                    opacity: 0.8
                },
                text: pbt2025.map(v => formatNumber(v)),
                textposition: 'outside',
                textfont: { 
                    size: 10, 
                    color: '#1F6FEB'
                },
                yaxis: 'y'
            };
            
            const layout = {
                margin: { t: 10, b: 10, l: 10, r: 10 },
                xaxis: { 
                    title: '',
                    tickfont: { size: 11 },
                    showgrid: false,
                    fixedrange: true
                },
                yaxis: {
                    title: '',
                    titlefont: { size: 11 },
                    tickfont: { size: 10 },
                    showgrid: true,
                    gridcolor: '#E1E4EB',
                    tickmode: 'array',
                    tickvals: tickvals,
                    ticktext: ticktext,
                    showticklabels: false,
                    range: [startTick, endTick],
                    fixedrange: true
                },
                showlegend: true,
                legend: {
                    orientation: 'h',
                    y: -0.25,
                    x: 0.5,
                    xanchor: 'center',
                    font: { size: 11 }
                },
                height: 300,
                barmode: 'group',
                hovermode: 'x unified',
                dragmode: false
            };
            
            Plotly.newPlot('chart-company-quarterly-pbt-comparison', [trace2024, trace2025], layout, {staticPlot: false, responsive: true, displayModeBar: false});
        }

        // Update quarterly analysis section for Overview tab
        function updateQuarterlyAnalysisOverview() {
            if (!quarterlyComparison || !quarterlyComparison['2024'] || !quarterlyComparison['2025']) return;
            
            const quarters = ['Q1', 'Q2', 'Q3', 'Q4'];
            const revenue2024 = quarters.map(q => quarterlyComparison['2024'].revenue[q]);
            const revenue2025 = quarters.map(q => quarterlyComparison['2025'].revenue[q]);
            const pbt2024 = quarters.map(q => quarterlyComparison['2024'].pbt[q]);
            const pbt2025 = quarters.map(q => quarterlyComparison['2025'].pbt[q]);
            
            // T√≠nh to√°n t·ªïng v√† so s√°nh
            const totalRevenue2024 = revenue2024.reduce((a, b) => a + b, 0);
            const totalRevenue2025 = revenue2025.reduce((a, b) => a + b, 0);
            const totalPBT2024 = pbt2024.reduce((a, b) => a + b, 0);
            const totalPBT2025 = pbt2025.reduce((a, b) => a + b, 0);
            
            const revenueGrowth = ((totalRevenue2025 - totalRevenue2024) / totalRevenue2024 * 100).toFixed(1);
            const pbtGrowth = ((totalPBT2025 - totalPBT2024) / Math.abs(totalPBT2024) * 100).toFixed(1);
            
            // T√≠nh to√°n % thay ƒë·ªïi theo qu√Ω
            const q1Growth = ((revenue2025[0] - revenue2024[0]) / revenue2024[0] * 100).toFixed(1);
            const q2Growth = ((revenue2025[1] - revenue2024[1]) / revenue2024[1] * 100).toFixed(1);
            const q3Growth = ((revenue2025[2] - revenue2024[2]) / revenue2024[2] * 100).toFixed(1);
            const q4Growth = ((revenue2025[3] - revenue2024[3]) / revenue2024[3] * 100).toFixed(1);
            
            // T√≠nh t·ª∑ su·∫•t l·ª£i nhu·∫≠n
            const margin2024 = (totalPBT2024 / totalRevenue2024 * 100).toFixed(2);
            const margin2025 = (totalPBT2025 / totalRevenue2025 * 100).toFixed(2);
            
            // T·∫°o ph√¢n t√≠ch
            let analysis = '<ul style="margin: 0; padding-left: 20px;">';
            
            // Ph√¢n t√≠ch t·ªïng quan
            analysis += `<li><strong>T·ªïng quan:</strong> So v·ªõi c√πng k·ª≥ nƒÉm 2024, doanh thu nƒÉm 2025 ${parseFloat(revenueGrowth) >= 0 ? 'tƒÉng' : 'gi·∫£m'} <strong>${Math.abs(parseFloat(revenueGrowth))}%</strong> (t·ª´ ${formatNumber(totalRevenue2024)} l√™n ${formatNumber(totalRevenue2025)}).</li>`;
            
            if (parseFloat(revenueGrowth) > 0) {
                analysis += `<li>ƒê√¢y l√† d·∫•u hi·ªáu t√≠ch c·ª±c cho th·∫•y ho·∫°t ƒë·ªông kinh doanh ƒëang ph·ª•c h·ªìi v√† tƒÉng tr∆∞·ªüng so v·ªõi nƒÉm tr∆∞·ªõc.</li>`;
            } else {
                analysis += `<li>C·∫ßn ph√¢n t√≠ch s√¢u h∆°n v·ªÅ nguy√™n nh√¢n gi·∫£m doanh thu v√† c√≥ bi·ªán ph√°p kh·∫Øc ph·ª•c k·ªãp th·ªùi.</li>`;
            }
            
            // Ph√¢n t√≠ch theo qu√Ω
            analysis += `<li><strong>Theo qu√Ω:</strong></li>`;
            analysis += `<li>Qu√Ω 1: ${parseFloat(q1Growth) >= 0 ? 'TƒÉng' : 'Gi·∫£m'} ${Math.abs(parseFloat(q1Growth))}% (${formatNumber(revenue2024[0])} ‚Üí ${formatNumber(revenue2025[0])})</li>`;
            analysis += `<li>Qu√Ω 2: ${parseFloat(q2Growth) >= 0 ? 'TƒÉng' : 'Gi·∫£m'} ${Math.abs(parseFloat(q2Growth))}% (${formatNumber(revenue2024[1])} ‚Üí ${formatNumber(revenue2025[1])})</li>`;
            analysis += `<li>Qu√Ω 3: ${parseFloat(q3Growth) >= 0 ? 'TƒÉng' : 'Gi·∫£m'} ${Math.abs(parseFloat(q3Growth))}% (${formatNumber(revenue2024[2])} ‚Üí ${formatNumber(revenue2025[2])})</li>`;
            analysis += `<li>Qu√Ω 4: ${parseFloat(q4Growth) >= 0 ? 'TƒÉng' : 'Gi·∫£m'} ${Math.abs(parseFloat(q4Growth))}% (${formatNumber(revenue2024[3])} ‚Üí ${formatNumber(revenue2025[3])})</li>`;
            
            // Ph√¢n t√≠ch l·ª£i nhu·∫≠n
            analysis += `<li><strong>L·ª£i nhu·∫≠n:</strong> T·ªïng l·ª£i nhu·∫≠n nƒÉm 2025 ${parseFloat(pbtGrowth) >= 0 ? 'tƒÉng' : 'gi·∫£m'} <strong>${Math.abs(parseFloat(pbtGrowth))}%</strong> so v·ªõi 2024 (t·ª´ ${formatNumber(totalPBT2024)} l√™n ${formatNumber(totalPBT2025)}).</li>`;
            
            // Ph√¢n t√≠ch t·ª∑ su·∫•t l·ª£i nhu·∫≠n
            analysis += `<li><strong>T·ª∑ su·∫•t l·ª£i nhu·∫≠n:</strong> NƒÉm 2024 ƒë·∫°t ${margin2024}%, nƒÉm 2025 ƒë·∫°t ${margin2025}%. ${parseFloat(margin2025) > parseFloat(margin2024) ? 'C·∫£i thi·ªán' : parseFloat(margin2025) < parseFloat(margin2024) ? 'Gi·∫£m' : 'Gi·ªØ nguy√™n'} t·ª∑ su·∫•t l·ª£i nhu·∫≠n cho th·∫•y ${parseFloat(margin2025) > parseFloat(margin2024) ? 'hi·ªáu qu·∫£ ho·∫°t ƒë·ªông ƒë∆∞·ª£c n√¢ng cao' : parseFloat(margin2025) < parseFloat(margin2024) ? 'c·∫ßn t·∫≠p trung v√†o ki·ªÉm so√°t chi ph√≠ v√† t·ªëi ∆∞u h√≥a ho·∫°t ƒë·ªông' : 'ho·∫°t ƒë·ªông ·ªïn ƒë·ªãnh'}.</li>`;
            
            // ƒê√°nh gi√° v√† khuy·∫øn ngh·ªã
            const bestQuarter = quarters[revenue2025.indexOf(Math.max(...revenue2025))];
            const worstQuarter = quarters[revenue2025.indexOf(Math.min(...revenue2025))];
            
            analysis += `<li><strong>ƒê√°nh gi√°:</strong> Qu√Ω c√≥ doanh thu cao nh·∫•t l√† <strong>${bestQuarter}</strong> v·ªõi ${formatNumber(revenue2025[quarters.indexOf(bestQuarter)])}, trong khi qu√Ω th·∫•p nh·∫•t l√† <strong>${worstQuarter}</strong> v·ªõi ${formatNumber(revenue2025[quarters.indexOf(worstQuarter)])}.</li>`;
            
            if (parseFloat(revenueGrowth) > 5) {
                analysis += `<li><strong>Khuy·∫øn ngh·ªã:</strong> Ti·∫øp t·ª•c duy tr√¨ ƒë√† tƒÉng tr∆∞·ªüng, t·∫≠p trung v√†o c√°c qu√Ω c√≥ hi·ªáu su·∫•t t·ªët ƒë·ªÉ nh√¢n r·ªông m√¥ h√¨nh th√†nh c√¥ng.</li>`;
            } else if (parseFloat(revenueGrowth) < -5) {
                analysis += `<li><strong>Khuy·∫øn ngh·ªã:</strong> C·∫ßn c√≥ bi·ªán ph√°p kh·∫©n c·∫•p ƒë·ªÉ c·∫£i thi·ªán doanh thu, ƒë·∫∑c bi·ªát l√† ph√¢n t√≠ch nguy√™n nh√¢n gi·∫£m v√† ƒë·ªÅ xu·∫•t gi·∫£i ph√°p c·ª• th·ªÉ.</li>`;
            } else {
                analysis += `<li><strong>Khuy·∫øn ngh·ªã:</strong> C·∫ßn ·ªïn ƒë·ªãnh v√† c·∫£i thi·ªán hi·ªáu qu·∫£ ho·∫°t ƒë·ªông, t·∫≠p trung v√†o t·ªëi ∆∞u h√≥a chi ph√≠ v√† n√¢ng cao ch·∫•t l∆∞·ª£ng d·ªãch v·ª•.</li>`;
            }
            
            analysis += '</ul>';
            
            document.getElementById('quarterly-analysis-overview').innerHTML = analysis;
        }

        // Update company quarterly analysis section
        function updateCompanyQuarterlyAnalysis(compId) {
            if (!quarterlyCompanyComparison || !quarterlyCompanyComparison[compId] || !quarterlyCompanyComparison[compId]['2024'] || !quarterlyCompanyComparison[compId]['2025']) return;
            
            const companyName = compId === 'SAN' ? 'S' : compId === 'TEENNIE' ? 'T' : 'I';
            const quarters = ['Q1', 'Q2', 'Q3', 'Q4'];
            const revenue2024 = quarters.map(q => quarterlyCompanyComparison[compId]['2024'].revenue[q]);
            const revenue2025 = quarters.map(q => quarterlyCompanyComparison[compId]['2025'].revenue[q]);
            const pbt2024 = quarters.map(q => quarterlyCompanyComparison[compId]['2024'].pbt[q]);
            const pbt2025 = quarters.map(q => quarterlyCompanyComparison[compId]['2025'].pbt[q]);
            
            // T√≠nh to√°n t·ªïng v√† so s√°nh
            const totalRevenue2024 = revenue2024.reduce((a, b) => a + b, 0);
            const totalRevenue2025 = revenue2025.reduce((a, b) => a + b, 0);
            const totalPBT2024 = pbt2024.reduce((a, b) => a + b, 0);
            const totalPBT2025 = pbt2025.reduce((a, b) => a + b, 0);
            
            const revenueGrowth = ((totalRevenue2025 - totalRevenue2024) / totalRevenue2024 * 100).toFixed(1);
            const pbtGrowth = totalPBT2024 !== 0 ? ((totalPBT2025 - totalPBT2024) / Math.abs(totalPBT2024) * 100).toFixed(1) : 'N/A';
            
            // T√≠nh to√°n % thay ƒë·ªïi theo qu√Ω
            const q1Growth = ((revenue2025[0] - revenue2024[0]) / revenue2024[0] * 100).toFixed(1);
            const q2Growth = ((revenue2025[1] - revenue2024[1]) / revenue2024[1] * 100).toFixed(1);
            const q3Growth = ((revenue2025[2] - revenue2024[2]) / revenue2024[2] * 100).toFixed(1);
            const q4Growth = ((revenue2025[3] - revenue2024[3]) / revenue2024[3] * 100).toFixed(1);
            
            // T√≠nh t·ª∑ su·∫•t l·ª£i nhu·∫≠n
            const margin2024 = (totalPBT2024 / totalRevenue2024 * 100).toFixed(2);
            const margin2025 = (totalPBT2025 / totalRevenue2025 * 100).toFixed(2);
            
            // T·∫°o ph√¢n t√≠ch
            let analysis = '<ul style="margin: 0; padding-left: 20px;">';
            
            // Ph√¢n t√≠ch t·ªïng quan
            analysis += `<li><strong>C√¥ng ty ${companyName}:</strong> So v·ªõi c√πng k·ª≥ nƒÉm 2024, doanh thu nƒÉm 2025 ${parseFloat(revenueGrowth) >= 0 ? 'tƒÉng' : 'gi·∫£m'} <strong>${Math.abs(parseFloat(revenueGrowth))}%</strong> (t·ª´ ${formatNumber(totalRevenue2024)} l√™n ${formatNumber(totalRevenue2025)}).</li>`;
            
            if (parseFloat(revenueGrowth) > 5) {
                analysis += `<li>ƒê√¢y l√† d·∫•u hi·ªáu t√≠ch c·ª±c cho th·∫•y c√¥ng ty ${companyName} ƒëang ph·ª•c h·ªìi v√† tƒÉng tr∆∞·ªüng m·∫°nh so v·ªõi nƒÉm tr∆∞·ªõc.</li>`;
            } else if (parseFloat(revenueGrowth) < -5) {
                analysis += `<li>C·∫ßn ph√¢n t√≠ch s√¢u h∆°n v·ªÅ nguy√™n nh√¢n gi·∫£m doanh thu c·ªßa c√¥ng ty ${companyName} v√† c√≥ bi·ªán ph√°p kh·∫Øc ph·ª•c k·ªãp th·ªùi.</li>`;
            } else {
                analysis += `<li>Doanh thu c·ªßa c√¥ng ty ${companyName} t∆∞∆°ng ƒë·ªëi ·ªïn ƒë·ªãnh so v·ªõi nƒÉm tr∆∞·ªõc, c·∫ßn t·∫≠p trung v√†o c·∫£i thi·ªán hi·ªáu qu·∫£ ho·∫°t ƒë·ªông.</li>`;
            }
            
            // Ph√¢n t√≠ch theo qu√Ω
            analysis += `<li><strong>Theo qu√Ω:</strong></li>`;
            analysis += `<li>Qu√Ω 1: ${parseFloat(q1Growth) >= 0 ? 'TƒÉng' : 'Gi·∫£m'} ${Math.abs(parseFloat(q1Growth))}% (${formatNumber(revenue2024[0])} ‚Üí ${formatNumber(revenue2025[0])})</li>`;
            analysis += `<li>Qu√Ω 2: ${parseFloat(q2Growth) >= 0 ? 'TƒÉng' : 'Gi·∫£m'} ${Math.abs(parseFloat(q2Growth))}% (${formatNumber(revenue2024[1])} ‚Üí ${formatNumber(revenue2025[1])})</li>`;
            analysis += `<li>Qu√Ω 3: ${parseFloat(q3Growth) >= 0 ? 'TƒÉng' : 'Gi·∫£m'} ${Math.abs(parseFloat(q3Growth))}% (${formatNumber(revenue2024[2])} ‚Üí ${formatNumber(revenue2025[2])})</li>`;
            analysis += `<li>Qu√Ω 4: ${parseFloat(q4Growth) >= 0 ? 'TƒÉng' : 'Gi·∫£m'} ${Math.abs(parseFloat(q4Growth))}% (${formatNumber(revenue2024[3])} ‚Üí ${formatNumber(revenue2025[3])})</li>`;
            
            // Ph√¢n t√≠ch l·ª£i nhu·∫≠n
            if (pbtGrowth !== 'N/A') {
                analysis += `<li><strong>L·ª£i nhu·∫≠n:</strong> T·ªïng l·ª£i nhu·∫≠n nƒÉm 2025 ${parseFloat(pbtGrowth) >= 0 ? 'tƒÉng' : 'gi·∫£m'} <strong>${Math.abs(parseFloat(pbtGrowth))}%</strong> so v·ªõi 2024 (t·ª´ ${formatNumber(totalPBT2024)} l√™n ${formatNumber(totalPBT2025)}).</li>`;
            } else {
                analysis += `<li><strong>L·ª£i nhu·∫≠n:</strong> T·ªïng l·ª£i nhu·∫≠n nƒÉm 2025 l√† ${formatNumber(totalPBT2025)} (nƒÉm 2024: ${formatNumber(totalPBT2024)}).</li>`;
            }
            
            // Ph√¢n t√≠ch t·ª∑ su·∫•t l·ª£i nhu·∫≠n
            analysis += `<li><strong>T·ª∑ su·∫•t l·ª£i nhu·∫≠n:</strong> NƒÉm 2024 ƒë·∫°t ${margin2024}%, nƒÉm 2025 ƒë·∫°t ${margin2025}%. ${parseFloat(margin2025) > parseFloat(margin2024) ? 'C·∫£i thi·ªán' : parseFloat(margin2025) < parseFloat(margin2024) ? 'Gi·∫£m' : 'Gi·ªØ nguy√™n'} t·ª∑ su·∫•t l·ª£i nhu·∫≠n cho th·∫•y ${parseFloat(margin2025) > parseFloat(margin2024) ? 'hi·ªáu qu·∫£ ho·∫°t ƒë·ªông ƒë∆∞·ª£c n√¢ng cao' : parseFloat(margin2025) < parseFloat(margin2024) ? 'c·∫ßn t·∫≠p trung v√†o ki·ªÉm so√°t chi ph√≠' : 'ho·∫°t ƒë·ªông ·ªïn ƒë·ªãnh'}.</li>`;
            
            // ƒê√°nh gi√° v√† khuy·∫øn ngh·ªã
            const bestQuarter = quarters[revenue2025.indexOf(Math.max(...revenue2025))];
            const worstQuarter = quarters[revenue2025.indexOf(Math.min(...revenue2025))];
            
            analysis += `<li><strong>ƒê√°nh gi√°:</strong> Qu√Ω c√≥ doanh thu cao nh·∫•t l√† <strong>${bestQuarter}</strong> v·ªõi ${formatNumber(revenue2025[quarters.indexOf(bestQuarter)])}, trong khi qu√Ω th·∫•p nh·∫•t l√† <strong>${worstQuarter}</strong> v·ªõi ${formatNumber(revenue2025[quarters.indexOf(worstQuarter)])}.</li>`;
            
            if (parseFloat(revenueGrowth) > 5) {
                analysis += `<li><strong>Khuy·∫øn ngh·ªã:</strong> Ti·∫øp t·ª•c duy tr√¨ ƒë√† tƒÉng tr∆∞·ªüng, t·∫≠p trung v√†o c√°c qu√Ω c√≥ hi·ªáu su·∫•t t·ªët ƒë·ªÉ nh√¢n r·ªông m√¥ h√¨nh th√†nh c√¥ng.</li>`;
            } else if (parseFloat(revenueGrowth) < -5) {
                analysis += `<li><strong>Khuy·∫øn ngh·ªã:</strong> C·∫ßn c√≥ bi·ªán ph√°p kh·∫©n c·∫•p ƒë·ªÉ c·∫£i thi·ªán doanh thu, ƒë·∫∑c bi·ªát l√† ph√¢n t√≠ch nguy√™n nh√¢n gi·∫£m v√† ƒë·ªÅ xu·∫•t gi·∫£i ph√°p c·ª• th·ªÉ.</li>`;
            } else {
                analysis += `<li><strong>Khuy·∫øn ngh·ªã:</strong> C·∫ßn ·ªïn ƒë·ªãnh v√† c·∫£i thi·ªán hi·ªáu qu·∫£ ho·∫°t ƒë·ªông, t·∫≠p trung v√†o t·ªëi ∆∞u h√≥a chi ph√≠ v√† n√¢ng cao ch·∫•t l∆∞·ª£ng d·ªãch v·ª•.</li>`;
            }
            
            analysis += '</ul>';
            
            document.getElementById('quarterly-analysis-company').innerHTML = analysis;
        }

        // --- TAB 3: EXPENSE ---
        function switchExpenseCompany(compId) {
            currentExpenseCompanyId = compId;
            updateExpenseTab(compId);
            
            // Update buttons
            document.querySelectorAll('#tab-expense .segment-btn').forEach(btn => {
                btn.classList.remove('active');
                if(btn.getAttribute('data-company') === compId) 
                    btn.classList.add('active');
            });
            
            // Resize bi·ªÉu ƒë·ªì sau khi chuy·ªÉn c√¥ng ty
            setTimeout(() => {
                Plotly.Plots.resize('chart-expense-structure-quarterly');
            }, 100);
        }
        
        function updateExpenseTab(compId) {
            const data = companyData.find(c => c.id === compId);
            if (!data || !data.expense_data) {
                console.error('Expense data not found for:', compId);
                return;
            }
            
            const exp = data.expense_data;
            
            // Update KPI chips
            document.getElementById('exp-selling-total').textContent = formatNumber(exp.total_selling);
            document.getElementById('exp-selling-avg').textContent = `Trung b√¨nh th√°ng: ${formatNumber(exp.avg_monthly_selling)}`;
            
            document.getElementById('exp-admin-total').textContent = formatNumber(exp.total_admin);
            document.getElementById('exp-admin-avg').textContent = `Trung b√¨nh th√°ng: ${formatNumber(exp.avg_monthly_admin)}`;
            
            document.getElementById('exp-other-total').textContent = formatNumber(exp.total_other);
            document.getElementById('exp-other-avg').textContent = `Trung b√¨nh th√°ng: ${formatNumber(exp.avg_monthly_other)}`;
            
            document.getElementById('exp-total-ytd').textContent = formatNumber(exp.total_ytd);
            document.getElementById('exp-total-avg').textContent = `Trung b√¨nh th√°ng: ${formatNumber(exp.avg_monthly_total)}`;
            
            // Render bi·ªÉu ƒë·ªì c·∫•u tr√∫c chi ph√≠ theo qu√Ω
            renderExpenseStructureQuarterlyChart(compId);
            
            // Render waterfall charts theo qu√Ω
            renderExpenseWaterfallCharts(compId);
        }
        
        function renderExpenseStructureQuarterlyChart(compId) {
            const data = companyData.find(c => c.id === compId);
            if (!data || !data.expense_data) {
                console.error('Expense data not found for:', compId);
                return;
            }
            
            const exp2024 = data.expense_data.quarterly_2024;
            const exp2025 = data.expense_data.quarterly_2025;
            
            const quarters = ['Q1', 'Q2', 'Q3', 'Q4'];
            
            // T·∫°o x-axis labels: Q1 2024, Q1 2025, Q2 2024, Q2 2025, ...
            const xLabels = [];
            quarters.forEach(q => {
                xLabels.push(q + ' 2024');
                xLabels.push(q + ' 2025');
            });
            
            // H√†m format s·ªë kh√¥ng c√≥ ƒë∆°n v·ªã M
            function formatNumberNoUnit(num) {
                return new Intl.NumberFormat('vi-VN').format(Math.round(num));
            }
            
            // T·∫°o traces cho t·ª´ng lo·∫°i chi ph√≠ (stacked bar)
            // Th·ª© t·ª± traces quy·∫øt ƒë·ªãnh th·ª© t·ª± t·ª´ d∆∞·ªõi l√™n tr√™n trong c·ªôt
            // ƒê·ªãnh ph√≠ (CP Qu·∫£n l√Ω) ƒë·∫∑t ·ªü d∆∞·ªõi c√πng (trace ƒë·∫ßu ti√™n)
            const traces = [
                {
                    name: 'CP Qu·∫£n l√Ω',
                    x: xLabels,
                    y: quarters.flatMap(q => [exp2024.admin[q], exp2025.admin[q]]),
                    type: 'bar',
                    marker: { color: '#F5A623' },
                    text: quarters.flatMap(q => [
                        formatNumberNoUnit(exp2024.admin[q]),
                        formatNumberNoUnit(exp2025.admin[q])
                    ]),
                    textposition: 'inside',
                    textfont: { size: 9, color: 'white' },
                    textangle: 0 // N·∫±m ngang
                },
                {
                    name: 'CP B√°n h√†ng',
                    x: xLabels,
                    y: quarters.flatMap(q => [exp2024.selling[q], exp2025.selling[q]]),
                    type: 'bar',
                    marker: { color: '#E03A3E' },
                    text: quarters.flatMap(q => [
                        formatNumberNoUnit(exp2024.selling[q]),
                        formatNumberNoUnit(exp2025.selling[q])
                    ]),
                    textposition: 'inside',
                    textfont: { size: 9, color: 'white' },
                    textangle: 0 // N·∫±m ngang
                },
                {
                    name: 'CP Kh√°c',
                    x: xLabels,
                    y: quarters.flatMap(q => [exp2024.other[q], exp2025.other[q]]),
                    type: 'bar',
                    marker: { color: '#9B9B9B' },
                    text: [], // X√≥a label c·ªßa CP Kh√°c
                    textposition: 'none'
                }
            ];
            
            const layout = {
                barmode: 'stack', // C·ªôt ch·ªìng
                margin: { t: 10, b: 60, l: 50, r: 10 },
                xaxis: { 
                    title: '',
                    fixedrange: true,
                    tickfont: { size: 8 },
                    tickangle: -45,
                    automargin: true
                },
                yaxis: { 
                    title: 'Chi ph√≠ (M)',
                    fixedrange: true,
                    tickfont: { size: 9 },
                    titlefont: { size: 10 }
                },
                legend: { 
                    orientation: 'h', 
                    y: -0.35,
                    x: 0.5,
                    xanchor: 'center',
                    font: { size: 8 },
                    tracegroupgap: 5
                },
                height: 300,
                width: null, // Auto width ƒë·ªÉ responsive
                autosize: true,
                dragmode: false
            };
            
            const chartElement = document.getElementById('chart-expense-structure-quarterly');
            if (!chartElement) {
                console.error('Chart element not found');
                return;
            }
            
            // ƒê·ª£i m·ªôt ch√∫t ƒë·ªÉ ƒë·∫£m b·∫£o tab ƒë√£ visible v√† c√≥ width
            setTimeout(() => {
                // ƒê·∫£m b·∫£o width kh√¥ng v∆∞·ª£t qu√° container
                const containerWidth = chartElement.offsetWidth || window.innerWidth - 32;
                layout.width = Math.max(containerWidth, 300); // T·ªëi thi·ªÉu 300px
                
                // Purge chart c≈© n·∫øu c√≥
                Plotly.purge(chartElement);
                
                Plotly.newPlot('chart-expense-structure-quarterly', traces, layout, {
                    staticPlot: false, 
                    responsive: true, 
                    displayModeBar: false,
                    autosize: true
                });
            }, 100);
        }
        
        function renderExpenseWaterfallCharts(compId) {
            const data = companyData.find(c => c.id === compId);
            if (!data || !data.quarterly_data) {
                console.error('Quarterly data not found for:', compId);
                return;
            }
            
            const quarterly = data.quarterly_data;
            const quarters = ['Q1', 'Q2', 'Q3', 'Q4'];
            
            quarters.forEach((qName, idx) => {
                const qData = quarterly[idx];
                if (!qData) return;
                
                const chartId = 'chart-expense-waterfall-' + qName.toLowerCase();
                const chartElement = document.getElementById(chartId);
                if (!chartElement) return;
                
                // Extract values
                const revenue = qData.revenue || 0;
                const cogs = qData.cogs || 0;
                const gross_profit = revenue - cogs;
                const selling_exp = qData.selling_exp || 0;
                const admin_exp = qData.admin_exp || 0;
                const other_exp = qData.other_exp || 0;
                const pbt = qData.pbt || 0;
                
                // Prepare waterfall data
                const xLabels = ['Doanh Thu', 'Gi√° V·ªën', 'L√£i G·ªôp', 'CP B√°n H√†ng', 'CP QLDN', 'CP Kh√°c', 'LN Tr∆∞·ªõc Thu·∫ø'];
                const yValues = [revenue, -cogs, gross_profit, -selling_exp, -admin_exp, -other_exp, pbt];
                const measures = ['absolute', 'relative', 'total', 'relative', 'relative', 'relative', 'total'];
                
                // Format text: % inside column
                const textValues = [];
                for (let i = 0; i < xLabels.length; i++) {
                    const val = yValues[i];
                    const absVal = Math.abs(val);
                    let percentage = '';
                    if (xLabels[i] === 'Doanh Thu') {
                        percentage = '100%';
                    } else {
                        percentage = ((absVal / revenue) * 100).toFixed(1) + '%';
                    }
                    textValues.push(percentage);
                }
                
                // Create chart configuration
                const trace = {
                    type: 'waterfall',
                    name: 'Lu·ªìng P&L',
                    orientation: 'v',
                    measure: measures,
                    x: xLabels,
                    y: yValues,
                    text: textValues,
                    textposition: 'inside',
                    textfont: { size: 12, color: 'white', family: 'Arial', weight: 'bold' },
                    connector: { line: { color: '#1F6FEB', width: 2 } },
                    decreasing: { marker: { color: '#E03A3E', line: { color: '#E03A3E', width: 2 } } },
                    increasing: { marker: { color: '#1F6FEB', line: { color: '#1F6FEB', width: 2 } } },
                    totals: { marker: { color: '#1F6FEB', line: { color: '#1F6FEB', width: 2 } } }
                };
                
                const layout = {
                    title: '',
                    showlegend: false,
                    height: 280,
                    margin: { t: 10, b: 60, l: 10, r: 10 },
                    yaxis: { 
                        title: '',
                        titlefont: { size: 10 },
                        showticklabels: false,
                        fixedrange: true
                    },
                    xaxis: {
                        tickangle: -45,
                        tickfont: { size: 9 },
                        type: 'category',
                        fixedrange: true
                    },
                    font: { size: 9 },
                    template: 'plotly_white',
                    autosize: false,
                    width: chartElement.offsetWidth || 400,
                    dragmode: false
                };
                
                const config = {
                    staticPlot: false,
                    responsive: true,
                    displayModeBar: false
                };
                
                // Clear and render chart
                Plotly.purge(chartElement);
                Plotly.newPlot(chartId, [trace], layout, config);
            });
        }

        // --- TAB 4: ACTION ---
        function filterAction(timeframe, btn) {
            currentTimeframe = timeframe;
            renderActions(timeframe);
            
            // Update chips
            document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            btn.classList.add('active');

            const sub = document.getElementById('action-subtitle');
            if(timeframe === '0-30') sub.textContent = '∆Øu ti√™n kh·∫©n c·∫•p: C·∫Øt gi·∫£m chi ph√≠ & ·ªîn ƒë·ªãnh';
            else if(timeframe === '30-60') sub.textContent = 'Tri·ªÉn khai c√°c s√°ng ki·∫øn tƒÉng tr∆∞·ªüng & Quy tr√¨nh';
            else sub.textContent = 'Chi·∫øn l∆∞·ª£c d√†i h·∫°n & ƒê·∫ßu t∆∞';
        }

        function renderActions(timeframe) {
            const container = document.getElementById('action-list');
            container.innerHTML = '';
            
            const plans = actionPlans[timeframe];
            const order = ['SAN', 'TEENNIE', 'TGIL', 'GROUP'];
            const names = {'SAN': 'S - C·∫ßn ch√∫ √Ω', 'TEENNIE': 'T', 'TGIL': 'I', 'GROUP': 'C·∫•p T·∫≠p ƒêo√†n'};
            
            order.forEach(key => {
                const items = plans[key];
                if (!items || items.length === 0) return;
                
                const isOpen = (timeframe === '0-30' && key === 'SAN') ? 'open' : '';
                
                let html = `
                <div class="accordion">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        ${names[key]} <span style="font-size: 12px; font-weight: 400; line-height: 1.5;">‚ñº</span>
                    </div>
                    <div class="accordion-content ${isOpen}">
                `;
                
                items.forEach(action => {
                    html += `
                    <div class="action-item">
                        <span class="action-check">‚òê</span>
                        <span>${action}</span>
                    </div>`;
                });
                
                html += `</div></div>`;
                container.insertAdjacentHTML('beforeend', html);
            });
        }

        // --- HELPERS ---
        function renderOverviewChart() {
            // D·ªØ li·ªáu doanh thu v√† l·ª£i nhu·∫≠n theo th√°ng
            const months = ["T01", "T02", "T03", "T04", "T05", "T06", "T07", "T08", "T09", "T10"];
            const revenueData = [6319.87, 4673.24, 7692.92, 6174.64, 6839.96, 7501.75, 7069.47, 5723.05, 6616.45, 7771.72];
            const pbtData = [930.44, 195.87, 1569.68, 628.51, 752.22, 1264.85, 1145.53, 1161.45, 629.5, 806.31];
            
            // T√¨m th√°ng c√≥ doanh thu cao nh·∫•t v√† th·∫•p nh·∫•t
            const maxRevenueIndex = revenueData.indexOf(Math.max(...revenueData));
            const minRevenueIndex = revenueData.indexOf(Math.min(...revenueData));
            const maxRevenueMonth = months[maxRevenueIndex];
            const minRevenueMonth = months[minRevenueIndex];
            const maxRevenueValue = revenueData[maxRevenueIndex];
            const minRevenueValue = revenueData[minRevenueIndex];
            
            // T√≠nh to√°n tickvals v√† ticktext cho yaxis
            const maxValue = Math.max(...revenueData, ...pbtData);
            const minValue = Math.min(...revenueData, ...pbtData);
            const range = maxValue - minValue;
            const tickStep = range > 50000 ? 20000 : range > 20000 ? 10000 : 5000;
            const startTick = Math.floor(minValue / tickStep) * tickStep;
            const endTick = Math.ceil(maxValue / tickStep) * tickStep;
            const tickvals = [];
            const ticktext = [];
            for (let i = startTick; i <= endTick; i += tickStep) {
                tickvals.push(i);
                ticktext.push(i.toLocaleString('vi-VN') + ' M');
            }
            
            // Trace 1: Doanh thu (ƒê∆∞·ªùng - m√†u cam ƒë·∫≠m, m∆∞·ª£t, m·ªèng)
            const traceRevenue = {
                x: months,
                y: revenueData,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Doanh thu',
                line: { 
                    color: '#FF6B35', // M√†u cam ƒë·∫≠m
                    width: 2, // M·ªèng h∆°n
                    shape: 'spline', // L√†m m∆∞·ª£t
                    smoothing: 1.3
                },
                marker: { 
                    size: 7, 
                    color: '#FF6B35' 
                },
                yaxis: 'y',
                hoverinfo: 'x+y+name'
            };
            
            // Trace 2: L·ª£i nhu·∫≠n (C·ªôt)
            const tracePBT = {
                x: months,
                y: pbtData,
                type: 'bar',
                name: 'L·ª£i nhu·∫≠n',
                marker: { 
                    color: '#1F6FEB', 
                    opacity: 0.7 
                },
                text: pbtData.map(v => formatNumber(v)),
                textposition: 'outside',
                textfont: { 
                    size: 9, 
                    color: '#1F6FEB'
                },
                yaxis: 'y', // D√πng chung axis
                hoverinfo: 'x+y+name'
            };
            
            // Annotations cho th√°ng c√≥ doanh thu cao nh·∫•t v√† th·∫•p nh·∫•t
            const annotations = [
                {
                    x: maxRevenueMonth,
                    y: maxRevenueValue,
                    text: formatNumber(maxRevenueValue),
                    showarrow: true,
                    arrowhead: 2,
                    arrowsize: 1,
                    arrowwidth: 2,
                    arrowcolor: '#FF6B35',
                    ax: 0,
                    ay: -30,
                    font: { color: '#FF6B35', size: 10 },
                    bgcolor: 'rgba(255, 255, 255, 0.8)',
                    bordercolor: '#FF6B35',
                    borderwidth: 1
                },
                {
                    x: minRevenueMonth,
                    y: minRevenueValue,
                    text: formatNumber(minRevenueValue),
                    showarrow: true,
                    arrowhead: 2,
                    arrowsize: 1,
                    arrowwidth: 2,
                    arrowcolor: '#FF6B35',
                    ax: 0,
                    ay: 30,
                    font: { color: '#FF6B35', size: 10 },
                    bgcolor: 'rgba(255, 255, 255, 0.8)',
                    bordercolor: '#FF6B35',
                    borderwidth: 1
                }
            ];
            
            const layout = {
                margin: { t: 10, b: 60, l: 10, r: 20 },
                xaxis: { 
                    title: '',
                    tickangle: -45,
                    tickfont: { size: 10 },
                    showgrid: false,
                    fixedrange: true
                },
                yaxis: {
                    title: '', // X√≥a title
                    side: 'left',
                    showgrid: true,
                    gridcolor: '#E1E4EB',
                    tickfont: { size: 10 },
                    tickmode: 'array',
                    tickvals: tickvals,
                    ticktext: ticktext,
                    showticklabels: false,
                    fixedrange: true
                },
                showlegend: true,
                legend: {
                    orientation: 'h',
                    y: -0.2,
                    x: 0.5,
                    xanchor: 'center',
                    font: { size: 12 },
                    itemclick: false,
                    itemdoubleclick: false
                },
                height: 250,
                barmode: 'group',
                hovermode: 'x unified',
                dragmode: false,
                annotations: annotations
            };
            
            Plotly.newPlot('chart-overview', [traceRevenue, tracePBT], layout, {staticPlot: false, responsive: true, displayModeBar: false});
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('vi-VN').format(Math.round(num)) + ' M';
        }

        function toggleAccordion(header) {
            const content = header.nextElementSibling;
            content.classList.toggle('open');
            const icon = header.querySelector('span');
            icon.textContent = content.classList.contains('open') ? '‚ñº' : '‚ñ∂';
        }
    </script>
</body>
</html>
